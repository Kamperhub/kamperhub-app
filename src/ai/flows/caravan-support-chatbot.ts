// This is an autogenerated file from Firebase Studio.
'use server';
/**
 * @fileOverview A caravan support chatbot AI agent.
 *
 * - caravanSupportChatbot - A function that handles the chatbot interaction.
 * - CaravanSupportChatbotInput - The input type for the caravanSupportChatbot function.
 * - CaravanSupportChatbotOutput - The return type for the caravanSupportChatbot function.
 */

import {ai} from '@/ai/genkit';
import {z} from 'genkit';

const CaravanSupportChatbotInputSchema = z.object({
  question: z.string().describe('The question asked by the user about caravanning.'),
});
export type CaravanSupportChatbotInput = z.infer<typeof CaravanSupportChatbotInputSchema>;

const CaravanSupportChatbotOutputSchema = z.object({
  answer: z.string().describe('The answer to the user question.'),
  youtubeLink: z.string().optional().nullable().describe('An optional YouTube link that provides more information about the answer.'),
});
export type CaravanSupportChatbotOutput = z.infer<typeof CaravanSupportChatbotOutputSchema>;

const findYoutubeLink = ai.defineTool(
  {
    name: 'findYoutubeLink',
    description: 'Finds a relevant YouTube video link based on the user question.',
    inputSchema: z.object({
      question: z.string().describe('The question asked by the user about caravanning.'),
    }),
    outputSchema: z.string().optional(),
  },
  async (input) => {
    // TODO: Implement the logic to find a relevant YouTube video link based on the user question.
    // This is a placeholder implementation. Replace it with your actual implementation.
    if (input.question.includes('weight limits')) {
      return 'https://www.youtube.com/watch?v=xxxxxxxxxxx'; // Replace with a real YouTube link
    }
    return undefined;
  }
);

export async function caravanSupportChatbot(input: CaravanSupportChatbotInput): Promise<CaravanSupportChatbotOutput> {
  return caravanSupportChatbotFlow(input);
}

const prompt = ai.definePrompt({
  name: 'caravanSupportChatbotPrompt',
  input: {schema: CaravanSupportChatbotInputSchema},
  output: {schema: CaravanSupportChatbotOutputSchema},
  tools: [findYoutubeLink],
  prompt: `You are a caravan support chatbot. You are given a question about caravanning from the user. Answer the question to the best of your ability.

  If you think a YouTube video would be helpful to the user, use the findYoutubeLink tool to find a relevant link and include it in your response.

  Question: {{{question}}}`,
});

const caravanSupportChatbotFlow = ai.defineFlow(
  {
    name: 'caravanSupportChatbotFlow',
    inputSchema: CaravanSupportChatbotInputSchema,
    outputSchema: CaravanSupportChatbotOutputSchema,
  },
  async input => {
    const {output} = await prompt(input);
    return output!;
  }
);

