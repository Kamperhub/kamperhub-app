rules_version = '2';

service cloud.firestore {
  match /databases/kamperhubv2/documents {
    // Users can manage their own data in any subcollection under their user document.
    // This single rule covers vehicles, caravans, trips, inventory, etc.
    match /users/{userId}/{documents=**} {
      allow read, write: if request.auth.uid == userId;
    }
    
    // OAuth states for Google Tasks integration.
    // Any authenticated user needs to be able to create and read their own state doc.
    // The document ID is the random state string. We don't have a good way to secure this
    // to a specific user before the callback, but since it's single-use and random, it's low risk.
    match /oauthStates/{state} {
        allow read, write, delete: if request.auth != null;
    }
  }
}
